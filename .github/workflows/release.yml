name: Release

on:
  push:
    tags:
      - "v*.*.*"

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install dependencies
        run: pip install -e ".[dev]"

      - name: Lint (ruff check)
        run: ruff check .

      - name: Format check (ruff format)
        run: ruff format --check .

      - name: Tests
        run: pytest

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          body: |
            ## forscan-tools ${{ github.ref_name }}

            Safety-first FORScan helper for Ford/Lincoln/Mercury/Mazda diagnostics and configuration.

            ### Commands

            | Command | Description |
            |---------|-------------|
            | `parse-abt` | Parse `.abt` binary payloads; export to CSV / JSON / JSONL |
            | `decode-dtc` | Interpret DTCs with severity and triage steps |
            | `plan-change` | Build a pre-check, execution, and rollback checklist |
            | `trust-report` | Confidence report with official-source citations |
            | `explain` | Plain-language guide for As-Built, ABT, ECC, VID, TRID |

            ### Quick Start

            ```bash
            pip install forscan-tools
            python forscan_tools.py trust-report
            python forscan_tools.py explain --list-topics
            python forscan_tools.py decode-dtc --code P0171
            python forscan_tools.py plan-change --module ABS --parameter TireSize \
              --current 235/65R17 --target 245/65R17
            ```

            ### Safety Notes

            - This tool does **not** write to your vehicle.
            - Always backup before any FORScan write operation.
            - Use stable battery power during configuration/programming sessions.

            See [README](README.md) for full documentation.
